services:
  app:
    build: .
    container_name: ai-exchange
    restart: unless-stopped

    # Expose port 8000 to host (will be reverse proxied by Caddy/Nginx)
    ports:
      - "8000:8000"

    # Connect to existing Caddy network (for reverse proxy)
    networks:
      - caddy_default

    # Mount volumes for persistent data
    volumes:
      # Environment file
      - ./backend/.env:/app/backend/.env:ro

      # Persistent data directories
      - ./data/db:/app/data/db
      - ./data/uploads:/app/data/uploads
      - ./data/logs:/app/data/logs

    labels:
      - "com.centurylinklabs.watchtower.enable=true"
    
    # All config is in backend/.env (mounted read-only above)

    # Health check
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s

networks:
  caddy_default:
    external: true
